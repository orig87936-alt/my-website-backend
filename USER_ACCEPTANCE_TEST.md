# 用户验收测试清单 (T078)

## 测试环境准备

### 前置条件
- [ ] 后端服务运行在 http://localhost:8000
- [ ] 前端服务运行在 http://localhost:3000
- [ ] 数据库连接正常
- [ ] DeepSeek API 密钥配置正确

### 测试账号
- 管理员账号: `admin`
- 管理员密码: `admin123`

---

## 测试场景 1: 智能翻译系统

### 1.1 单字段翻译
- [ ] 登录管理后台
- [ ] 进入新闻创建页面
- [ ] 在中文标题字段输入: "人工智能的未来发展"
- [ ] 点击标题字段旁边的翻译按钮
- [ ] 验证英文标题自动填充
- [ ] 验证翻译结果合理
- [ ] 验证 Toast 提示显示成功

**预期结果**: 
- 英文标题应显示类似 "Future Development of Artificial Intelligence"
- 翻译时间 < 5 秒
- 显示成功提示

### 1.2 批量翻译
- [ ] 在新闻创建页面填写所有中文字段:
  - 标题: "人工智能技术突破"
  - 摘要: "本文介绍了最新的人工智能技术突破"
  - 导语: "人工智能领域取得重大进展"
  - 正文: 添加一段中文内容
- [ ] 点击"批量翻译"按钮
- [ ] 验证所有英文字段自动填充
- [ ] 验证翻译结果合理
- [ ] 验证进度提示显示

**预期结果**:
- 所有英文字段应正确填充
- 批量翻译时间 < 15 秒
- 显示翻译进度和成功提示

### 1.3 翻译缓存
- [ ] 重复 1.1 的操作（使用相同文本）
- [ ] 验证第二次翻译速度明显更快
- [ ] 检查后端日志显示 "Cache hit"

**预期结果**:
- 缓存命中时翻译时间 < 1 秒
- 后端日志显示 "✅ Cache hit for hash..."

---

## 测试场景 2: 文档智能导入

### 2.1 Markdown 文档上传

#### 准备测试文件
创建 `test.md` 文件:
```markdown
# 测试新闻标题

## 简介

这是一篇测试新闻文章。

## 主要内容

### 第一部分

这是第一部分的内容。

### 第二部分

这是第二部分的内容，包含代码示例：

```python
def hello():
    print("Hello, World!")
```

## 总结

> 这是一个引用示例

- 列表项 1
- 列表项 2
```

#### 测试步骤
- [ ] 登录管理后台
- [ ] 点击"上传文档"按钮
- [ ] 拖拽或选择 `test.md` 文件
- [ ] 验证文件预览显示正确
- [ ] 验证解析的内容块显示正确
- [ ] 点击"使用此内容"按钮
- [ ] 验证表单字段自动填充:
  - 标题应为 "测试新闻标题"
  - 正文应包含所有内容块
  - 代码块应正确显示
  - 引用应正确显示

**预期结果**:
- 文档解析时间 < 2 秒
- 所有 Markdown 语法正确解析
- 表单自动填充正确

### 2.2 Word 文档上传

#### 准备测试文件
创建 `test.docx` 文件，包含:
- 标题
- 多个段落
- 列表
- 图片（可选）

#### 测试步骤
- [ ] 点击"上传文档"按钮
- [ ] 选择 `test.docx` 文件
- [ ] 验证文件预览显示正确
- [ ] 验证解析的内容块显示正确
- [ ] 如果包含图片，验证图片正确提取
- [ ] 点击"使用此内容"按钮
- [ ] 验证表单字段自动填充

**预期结果**:
- Word 文档解析时间 < 3 秒
- 文本内容正确提取
- 图片正确上传（如果有）

### 2.3 AI 元数据生成
- [ ] 上传一个包含丰富内容的文档
- [ ] 验证 AI 生成的摘要合理
- [ ] 验证 AI 建议的分类合理
- [ ] 验证 AI 提取的标签相关

**预期结果**:
- 摘要应简洁准确（100-200 字）
- 分类应从预定义列表中选择
- 标签应相关且有意义（3-5 个）

### 2.4 文档上传 + 自动翻译
- [ ] 上传一个中文 Markdown 文档
- [ ] 勾选"自动翻译"选项
- [ ] 验证文档解析完成
- [ ] 验证自动翻译完成
- [ ] 验证中英文字段都已填充

**预期结果**:
- 文档解析 + 翻译总时间 < 20 秒
- 中英文内容都正确填充

---

## 测试场景 3: 手动输入 Markdown 支持

### 3.1 图片语法
- [ ] 在正文编辑器中输入: `![测试图片](https://example.com/image.jpg)`
- [ ] 保存新闻
- [ ] 在前端查看新闻
- [ ] 验证图片正确显示

**预期结果**:
- 图片应正确渲染
- alt 文本应正确显示

### 3.2 多级标题
- [ ] 在正文编辑器中输入:
```markdown
## 二级标题
### 三级标题
#### 四级标题
```
- [ ] 保存新闻
- [ ] 在前端查看新闻
- [ ] 验证标题层级正确

**预期结果**:
- 标题应有正确的层级样式
- 字体大小应递减

### 3.3 代码块
- [ ] 在正文编辑器中输入:
````markdown
```python
def hello():
    print("Hello")
```
````
- [ ] 保存新闻
- [ ] 在前端查看新闻
- [ ] 验证代码块正确显示

**预期结果**:
- 代码应有语法高亮
- 代码块应有背景色
- 代码格式应保持

### 3.4 引用
- [ ] 在正文编辑器中输入: `> 这是一个引用`
- [ ] 保存新闻
- [ ] 在前端查看新闻
- [ ] 验证引用样式正确

**预期结果**:
- 引用应有左侧边框
- 引用应有特殊背景色

---

## 测试场景 4: 安全性测试

### 4.1 XSS 防护
- [ ] 尝试在正文中输入: `<script>alert('XSS')</script>`
- [ ] 保存新闻
- [ ] 在前端查看新闻
- [ ] 验证脚本未执行

**预期结果**:
- 脚本标签应被过滤或转义
- 不应弹出 alert 对话框

### 4.2 文件大小限制
- [ ] 尝试上传一个 > 10MB 的文件
- [ ] 验证显示错误提示

**预期结果**:
- 应显示 "文件大小超过限制" 错误
- 文件不应被上传

### 4.3 文件类型验证
- [ ] 尝试上传一个 .txt 文件
- [ ] 验证显示错误提示

**预期结果**:
- 应显示 "不支持的文件类型" 错误
- 只接受 .md 和 .docx 文件

---

## 测试场景 5: 性能测试

### 5.1 翻译性能
- [ ] 测试单字段翻译时间 < 5 秒
- [ ] 测试批量翻译（4 字段）时间 < 15 秒
- [ ] 测试缓存命中时间 < 1 秒

### 5.2 文档解析性能
- [ ] 测试 Markdown 解析时间 < 2 秒
- [ ] 测试 Word 解析时间 < 3 秒
- [ ] 测试大文档（50+ 段落）解析时间 < 5 秒

### 5.3 缓存统计
- [ ] 访问 http://localhost:8000/docs
- [ ] 测试 GET /api/v1/translation/cache-stats 端点
- [ ] 验证返回缓存统计信息

**预期结果**:
- 应返回总缓存条目数
- 应返回最近 24h 条目数
- 应返回缓存命中率

---

## 测试场景 6: 后台任务

### 6.1 缓存清理任务
- [ ] 检查后端日志
- [ ] 验证启动时显示 "🕐 Next cache cleanup scheduled at..."
- [ ] 验证任务调度器正常运行

**预期结果**:
- 后端日志应显示调度器启动信息
- 应显示下次清理时间（2 AM UTC）

---

## 测试结果汇总

### 通过的测试场景
- [ ] 场景 1: 智能翻译系统
- [ ] 场景 2: 文档智能导入
- [ ] 场景 3: 手动输入 Markdown 支持
- [ ] 场景 4: 安全性测试
- [ ] 场景 5: 性能测试
- [ ] 场景 6: 后台任务

### 发现的问题
记录测试过程中发现的任何问题:

1. 
2. 
3. 

### 测试结论
- [ ] 所有核心功能正常工作
- [ ] 性能达标
- [ ] 安全性验证通过
- [ ] 可以发布到生产环境

---

## 测试人员签名

- 测试人员: _______________
- 测试日期: _______________
- 测试结果: [ ] 通过 [ ] 不通过

